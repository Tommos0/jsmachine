<!doctype html>
<html>
    <head>
        <style type="text/css">
            .hide-loading { display: none }
        </style>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/systemjs/0.21.0/system.js"></script>
        <script>
            function waitTick() {
                return new Promise(function(resolve) {
                    window.setTimeout(resolve, 5000);
                });
            }

            window.addEventListener('load', function() {
                const loadingElm = document.createElement('div');
                loadingElm.innerHTML='Loading';
                document.body.appendChild(loadingElm);
                try {
                    const key = window.location.href.split('=')[1];
                    let url = 'index.js';
                    if (key) {
                        url = 'https://us-central1-jsmachine-us.cloudfunctions.net/get?key=' + key;
                    }
                    SystemJS.import('stdlib.js')
                        .then(() => SystemJS.import('machine.js'))
                        .then(() => SystemJS.import('display.js'))
                        .then(() => SystemJS.import('input.js'))
                        .then(() => SystemJS.import('cssloader.js'))
                        .then(() => includeCSS('style.css'))
                        .then(() => machine.runUrl(url))
                        .then(() => {
                            document.body.removeChild(loadingElm);
                            [].forEach.call(
                                document.getElementsByClassName('hide-loading'),
                                (elm) => elm.setAttribute('class', '')
                            );
                        });
                } catch (e) {
                    document.write('Error loading..');
                    document.write(e);
                }
            });
        </script>
    </head>
    <body>
        <div class="hide-loading" id="welcome">Welcome, use clear() to clear, use save() to save!</div>
    </body>
</html>
